<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Onboarding</title>
  <link rel="stylesheet" href="/css/applicant_onboarding.css" />
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <style>
    /* Enhanced styles for better UI */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }
    
    .header-container {
      background-color: #fff;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }
    
    .header {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 0 20px;
    }
    
    .logo {
      position: absolute;
      left: 20px;
      height: 50px;
      width: auto;
    }
    
    h1 {
      color: #07ACB9;
      margin: 0;
      font-weight: 600;
    }
    
    .subheader {
      text-align: center;
      font-size: 1.5rem;
      margin: 30px 0;
      color: #124A5C;
      font-weight: 600;
    }
    
    .table-header-left {
      max-width: 1200px;
      margin: 0 auto 15px;
      padding: 0 20px;
      font-weight: 600;
      color: #333;
      font-size: 1.1rem;
    }
    
    table {
      max-width: 1200px;
      margin: 0 auto 40px;
      width: calc(100% - 40px);
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    th {
      background-color: #124A5C;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 500;
    }
    
    td {
      padding: 15px;
      border-bottom: 1px solid #e9ecef;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:hover {
      background-color: #f8f9fa;
    }
    
    .table-checkbox {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .signature-container {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      width: 350px;
    }
    
    .signature-canvas {
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    
    .action-buttons {
      display: flex;
      justify-content: space-between;
    }
    
    .action-buttons button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .btn-submit-signature {
      background-color: #07ACB9;
      color: white;
    }
    
    .btn-clear-signature {
      background-color: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .btn-cancel-signature {
      background-color: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .signature-preview {
      margin-top: 10px;
      min-height: 30px;
    }
    
    .signature-preview img {
      max-width: 100%;
      max-height: 80px;
    }
    
    .btn-sign {
      background-color: #07ACB9;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 8px;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .btn-sign:hover {
      background-color: #059ca4;
    }
    
    .notes {
      max-width: 1200px;
      margin: 0 auto 40px;
      padding: 0 20px;
    }
    
    .notes label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #333;
    }
    
    .non-editable-notes {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      min-height: 100px;
    }
    
    .verification-section {
      max-width: 1200px;
      margin: 0 auto 40px;
      display: flex;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    .verification-left {
      flex: 1;
      padding-right: 20px;
    }
    
    .manager-signature {
      flex: 1;
      padding-left: 20px;
      border-left: 1px solid #e9ecef;
    }
    
    .verification-section h2 {
      color: #124A5C;
      margin-top: 0;
      font-weight: 600;
    }
    
    .verification-section h3 {
      color: #333;
      margin-top: 0;
      font-weight: 600;
    }
    
    .manager-verify {
      width: 18px;
      height: 18px;
      margin-right: 10px;
    }
    
    .btn-submit {
      display: block;
      margin: 0 auto 40px;
      background-color: #124A5C;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .btn-submit:hover {
      background-color: #0b3a46;
    }
    
    /* Dark overlay for when signature pad is open */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  <div class="header-container">
    <div class="header">
      <img src="/images/prime_assets/primeinfra-logo-with-name.png" alt="Prime Infra Logo" class="logo" />
      <h1>Onboarding</h1>
    </div>
  </div>


<div class="applicant-info-container" style="max-width: 1200px; margin: 0 auto 30px; background-color: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); padding: 20px;">
  <h2 style="color: #124A5C; margin-top: 0; margin-bottom: 15px; font-weight: 600;">Employee Information</h2>
  
  <div style="display: flex; flex-wrap: wrap; gap: 30px;">
    <div style="flex: 1; min-width: 300px;">
      <p><strong>Name:</strong> <%= applicant.fullName %></p>
      <p><strong>Email:</strong> <%= applicant.email %></p>
      <p><strong>Phone:</strong> <%= applicant.phoneNo %></p>
    </div>
    <div style="flex: 1; min-width: 300px;">
      <p><strong>Position:</strong> <%= applicant.jobTitle %></p>
      <p><strong>Department:</strong> <%= applicant.department %></p>
      <p><strong>Start Date:</strong> <%= applicant.startDate %></p>
    </div>
  </div>
  
  <div style="background-color: #f0f8ff; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #07ACB9;">
    <p style="margin: 0;"><strong>Welcome to Company ABC!</strong> Please complete the first day checklist below to prepare for your onboarding.</p>
  </div>
</div>

<!-- Update the hidden input field for applicant ID -->
<input type="hidden" id="applicant-id" name="applicantId" value="<%= applicant.applicantId %>">

<div id="success-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2000;">
  <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); text-align: center; max-width: 500px; width: 90%;">
    <div style="margin-bottom: 15px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#07ACB9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    </div>
    <h2 style="color: #124A5C; margin-top: 0; margin-bottom: 15px;">First Day Checklist Accomplished!</h2>
    <p style="font-size: 16px; margin-bottom: 20px;">Congratulations on completing your first day checklist. Your onboarding is progressing well!</p>
    <p style="font-size: 16px; margin-bottom: 20px;">Your manager will be notified, and you'll receive further instructions for your next steps soon.</p>
    <button id="continue-btn" style="background-color: #07ACB9; color: white; border: none; padding: 12px 24px; border-radius: 4px; font-size: 16px; font-weight: 500; cursor: pointer; transition: background-color 0.2s;">Continue to Dashboard</button>
  </div>
</div>

  <div class="subheader">Accomplishing of First Day Checklist</div>
  <div class="table-header-left">First Day Checklist Guide for Applicant</div>

  <!-- Checklist Table with Hardcoded Items -->
  <table>
    <thead>
      <tr>
        <th>Activities</th>
        <th>Where</th>
        <th>Contact Person &amp; Signature Verification</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>Finding your workstation + Meeting your team</span>
          </label>
        </td>
        <td>Your Department's Floor</td>
        <td>
          Line Manager
          <br />
          <button class="btn-sign" data-target="signature-container-1">Sign Here</button>
          <div id="signature-container-1" class="signature-container">
            <canvas id="signature-canvas-1" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-1" data-container="signature-container-1">
                Submit Signature
              </button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-1">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-1">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-1" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td>
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>Creation of company ID</span>
          </label>
        </td>
        <td>19F Facilities Mgt Room</td>
        <td>
          Zac Apron
          <br />
          <button class="btn-sign" data-target="signature-container-2">Sign Here</button>
          <div id="signature-container-2" class="signature-container">
            <canvas id="signature-canvas-2" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-2" data-container="signature-container-2">
                Submit Signature
              </button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-2">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-2">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-2" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td>
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>Building/Door access</span>
          </label>
        </td>
        <td>19F Security</td>
        <td>
          Billie Jean
          <br />
          <button class="btn-sign" data-target="signature-container-3">Sign Here</button>
          <div id="signature-container-3" class="signature-container">
            <canvas id="signature-canvas-3" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-3" data-container="signature-container-3">
                Submit Signature
              </button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-3">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-3">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-3" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td>
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>Claim IT equipment</span>
          </label>
        </td>
        <td>20th Floor IT Dept, right wing</td>
        <td>
          Johnny Legend
          <br />
          <button class="btn-sign" data-target="signature-container-4">Sign Here</button>
          <div id="signature-container-4" class="signature-container">
            <canvas id="signature-canvas-4" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-4" data-container="signature-container-4">
                Submit Signature
              </button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-4">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-4">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-4" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td>
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>Claim IT equipment</span>
          </label>
        </td>
        <td>Your Department's Floor</td>
        <td>
          Line Manager
          <br />
          <button class="btn-sign" data-target="signature-container-5">Sign Here</button>
          <div id="signature-container-5" class="signature-container">
            <canvas id="signature-canvas-5" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-5" data-container="signature-container-5">
                Submit Signature
              </button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-5">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-5">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-5" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>
              Submit Government IDs 
              <em style="font-style: italic; color: #495057;"> (Philhealth ID Card, Pag-Ibig ID, SSS ID, TIN)</em>
            </span>
          </label>
        </td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">HR Department, 18th Floor</td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          Jane Smith
          <br />
          <button class="btn-sign" data-target="signature-container-6">Sign Here</button>
          <div id="signature-container-6" class="signature-container">
            <canvas id="signature-canvas-6" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-6" data-container="signature-container-6">Submit Signature</button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-6">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-6">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-6" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>
              Submit Government Clearances
              <em style="font-style: italic; color: #495057;"> (NBI Clearance, BIR Form 2316)</em>
            </span>
          </label>
        </td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">HR Department, 18th Floor</td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          Jane Smith
          <br />
          <button class="btn-sign" data-target="signature-container-7">Sign Here</button>
          <div id="signature-container-7" class="signature-container">
            <canvas id="signature-canvas-7" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-7" data-container="signature-container-7">Submit Signature</button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-7">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-7">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-7" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>
              Submit Personal & Identity Document
              <em style="font-style: italic; color: #495057;"> (PSA-issues Birth Certificate, 2x2 Photo with White Background)</em>
            </span>
          </label>
        </td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">HR Department, 18th Floor</td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          Jane Smith
          <br />
          <button class="btn-sign" data-target="signature-container-8">Sign Here</button>
          <div id="signature-container-8" class="signature-container">
            <canvas id="signature-canvas-8" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-8" data-container="signature-container-8">Submit Signature</button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-8">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-8">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-8" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>
              Submit Educational & Professional Records
              <em style="font-style: italic; color: #495057;"> (Transcript of Records, Medical Clearance)</em>
            </span>
          </label>
        </td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">HR Department, 18th Floor</td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          Jane Smith
          <br />
          <button class="btn-sign" data-target="signature-container-9">Sign Here</button>
          <div id="signature-container-9" class="signature-container">
            <canvas id="signature-canvas-9" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-9" data-container="signature-container-9">Submit Signature</button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-9">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-9">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-9" class="signature-preview"></div>
        </td>
      </tr>
      <tr>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          <label>
            <input type="checkbox" class="table-checkbox" />
            <span>
              Submit Employment & Financial Setup
              <em style="font-style: italic; color: #495057;"> (Bank Account Details, Signed Employment Contract)</em>
            </span>
          </label>
        </td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">HR Department, 18th Floor</td>
        <td style="padding: 15px; border-bottom: 1px solid #e9ecef;">
          Jane Smith
          <br />
          <button class="btn-sign" data-target="signature-container-10">Sign Here</button>
          <div id="signature-container-10" class="signature-container">
            <canvas id="signature-canvas-10" class="signature-canvas" width="300" height="100"></canvas>
            <div class="action-buttons">
              <button class="btn-submit-signature" data-canvas="signature-canvas-10" data-container="signature-container-10">Submit Signature</button>
              <button class="btn-clear-signature" data-canvas="signature-canvas-10">Clear</button>
              <button class="btn-cancel-signature" data-container="signature-container-10">Cancel</button>
            </div>
          </div>
          <div id="signature-preview-10" class="signature-preview"></div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Notes Section -->
  <div class="notes">
    <label for="notes">Notes:</label>
    <div id="notes" class="non-editable-notes">Add any notes here...</div>
  </div>

  <!-- Line Manager Verification Section -->
  <div class="verification-section">
    <div class="verification-left">
      <h2>Line Manager Verification</h2>
      <p>
        Review the checklist and captured signatures above. Then verify by signing
        in the designated area.
      </p>
      <label>
        <input type="checkbox" id="manager-verify-checkbox" class="manager-verify" />
        <span>Checklist Verified by Line Manager</span>
      </label>
    </div>
    <div class="manager-signature">
      <h3>Manager Signature</h3>
      <button class="btn-sign" data-target="manager-signature-container">Sign Here</button>
      <div id="manager-signature-container" class="signature-container">
        <canvas id="manager-signature-canvas" class="signature-canvas" width="300" height="100"></canvas>
        <div class="action-buttons">
          <button class="btn-submit-signature" data-canvas="manager-signature-canvas" data-container="manager-signature-container">
            Submit Signature
          </button>
          <button class="btn-clear-signature" data-canvas="manager-signature-canvas">Clear</button>
          <button class="btn-cancel-signature" data-container="manager-signature-container">Cancel</button>
        </div>
      </div>
      <div id="manager-signature-preview" class="signature-preview"></div>
    </div>
  </div>

  <button class="btn-submit">Submit First Day Checklist</button>


  

  <script>
    const signaturePads = {};
    const overlay = document.getElementById('overlay');

    const successModal = document.getElementById('success-modal');


    // Function to initialize a signature pad on a canvas element if not already done
    function initSignaturePad(canvas) {
      if (!signaturePads[canvas.id]) {
        signaturePads[canvas.id] = new SignaturePad(canvas, {
          backgroundColor: 'rgba(255, 255, 255, 0)',
          penColor: 'black'
        });
      }
    }

    // Show signature container on "Sign Here" click
    document.querySelectorAll('.btn-sign').forEach((button) => {
      button.addEventListener('click', function () {
        const target = this.getAttribute('data-target');
        const container = document.getElementById(target);
        container.style.display = 'block';
        overlay.style.display = 'block';
        const canvas = container.querySelector('canvas');
        initSignaturePad(canvas);
      });
    });

    // Submit signature: capture and preview the signature image, then hide container
    document.querySelectorAll('.btn-submit-signature').forEach((button) => {
      button.addEventListener('click', function () {
        const canvasId = this.getAttribute('data-canvas');
        const containerId = this.getAttribute('data-container');
        const canvas = document.getElementById(canvasId);
        const container = document.getElementById(containerId);
        if (signaturePads[canvasId].isEmpty()) {
          alert('Please provide a signature before submitting.');
          return;
        }
        const signatureImage = signaturePads[canvasId].toDataURL();
        let previewId;
        if (canvasId === 'manager-signature-canvas') {
          previewId = 'manager-signature-preview';
        } else {
          const canvasNumber = canvasId.split('-').pop();
          previewId = 'signature-preview-' + canvasNumber;
        }
        const previewContainer = document.getElementById(previewId);
        previewContainer.innerHTML = '<img src="' + signatureImage + '" alt="Signature Preview" />';
        container.style.display = 'none';
        overlay.style.display = 'none';
      });
    });

    // Clear signature pad
    document.querySelectorAll('.btn-clear-signature').forEach((button) => {
      button.addEventListener('click', function () {
        const canvasId = this.getAttribute('data-canvas');
        signaturePads[canvasId].clear();
      });
    });

    // Cancel signature: hide container without saving
    document.querySelectorAll('.btn-cancel-signature').forEach((button) => {
      button.addEventListener('click', function () {
        const containerId = this.getAttribute('data-container');
        document.getElementById(containerId).style.display = 'none';
        overlay.style.display = 'none';
      });
    });


      // Continue button in success modal
  document.getElementById('continue-btn').addEventListener('click', function() {
    window.location.href = '/staff/login';
  });


    // Final submission: validate checklist items, signatures, and manager verification/signature
    document.querySelector('.btn-submit').addEventListener('click', async function () {
  const applicantId = document.getElementById('applicant-id').value;

  // Basic validation for checkboxes and signatures
  let allChecked = true;
  let allSigned = true;

  // Check if all checkboxes are checked
  document.querySelectorAll('.table-checkbox').forEach((checkbox, index) => {
    if (!checkbox.checked) {
      allChecked = false;
    }

    const preview = document.getElementById('signature-preview-' + (index + 1));
    if (!preview || !preview.innerHTML.trim()) {
      allSigned = false;
    }
  });

  // Check if manager verified and signed
  const managerVerified = document.getElementById('manager-verify-checkbox').checked;
  const managerSignaturePreview = document.getElementById('manager-signature-preview');
  const managerSigned = managerSignaturePreview && managerSignaturePreview.innerHTML.trim();

  // Display validation alerts if needed
  if (!allChecked) {
    alert('Please complete all checklist items.');
    return;
  }
  if (!allSigned) {
    alert('Please capture the signature for all tasks.');
    return;
  }
  if (!managerVerified) {
    alert('Line manager must verify the checklist.');
    return;
  }
  if (!managerSigned) {
    alert('Line manager must provide a signature.');
    return;
  }

  // Send only the applicant ID to update status
  try {
    const response = await fetch('/onboarding/update-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        applicantId: applicantId
      })
    });

    const result = await response.json();
    if (result.success) {
      // Show success modal
      document.getElementById('success-modal').style.display = 'block';
    } else {
      alert('Error updating status: ' + result.message);
    }
  } catch (error) {
    console.error('Error updating status:', error);
    alert('Failed to update status. Try again.');
  }
});

    // Final submission: validate checklist items, signatures, and manager verification/signature
    // document.querySelector('.btn-submit').addEventListener('click', async function () {

    //   const applicantId = document.getElementById('applicant-id').value;

    //   let allChecked = true;
    //   let allSigned = true;
    //   const checklistData = [];
    //   const signatureData = {};

    //   // Collect checkbox & signature data
    //   document.querySelectorAll('.table-checkbox').forEach((checkbox, index) => {
    //     // Get the content from the row
    //     const row = checkbox.closest('tr');
    //     const task = checkbox.nextElementSibling.innerText.trim();
    //     const where = row.cells[1].innerText.trim();
    //     const contactPerson = row.cells[2].innerText.split('\n')[0].trim();
        
    //     checklistData.push({
    //       task: task,
    //       where: where,
    //       contactPerson: contactPerson,
    //       completed: checkbox.checked
    //     });

    //     if (!checkbox.checked) {
    //       allChecked = false;
    //     }

    //     const preview = document.getElementById('signature-preview-' + (index + 1));
    //     if (!preview || !preview.innerHTML.trim()) {
    //       allSigned = false;
    //     }
    //   });

    //   const managerVerified = document.getElementById('manager-verify-checkbox').checked;
    //   const managerSignaturePreview = document.getElementById('manager-signature-preview');
    //   const managerSigned = managerSignaturePreview && managerSignaturePreview.innerHTML.trim();

    //   if (!allChecked) {
    //     alert('Please complete all checklist items.');
    //     return;
    //   }
    //   if (!allSigned) {
    //     alert('Please capture the signature for all tasks.');
    //     return;
    //   }
    //   if (!managerVerified) {
    //     alert('Line manager must verify the checklist.');
    //     return;
    //   }
    //   if (!managerSigned) {
    //     alert('Line manager must provide a signature.');
    //     return;
    //   }

    //   // Collect signatures
    //   Object.keys(signaturePads).forEach((canvasId) => {
    //     if (!signaturePads[canvasId].isEmpty()) {
    //       signatureData[canvasId] = signaturePads[canvasId].toDataURL();
    //     }
    //   });

    //   const notes = document.getElementById('notes').innerText.trim();

    //   // Send Data to Backend
    //   try {
    //     const response = await fetch('/onboarding', {
    //       method: 'POST',
    //       headers: {
    //         'Content-Type': 'application/json'
    //       },
    //       body: JSON.stringify({
    //         applicantId: applicantId,
    //         checklist: checklistData,
    //         signatures: signatureData,
    //         managerVerified,
    //         notes
    //       })
    //     });

    //     const result = await response.json();
    //     if (result.success) {
    //       alert('Checklist successfully submitted!');
    //       window.location.href = '/onboarding/employee-records'; // Redirect to next step
    //     } else {
    //       alert('Error submitting checklist: ' + result.message);
    //     }
    //   } catch (error) {
    //     console.error('Error submitting form:', error);
    //     alert('Failed to submit checklist. Try again.');
    //   }
    // });
  </script>
</body>
</html>